{
  "hash": "8d1098476012c2d50c26432787cf8b98",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Activity12\"\nformat: html\nwarning: false\nmessage: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# Time Series Essentials, install if needed!\nlibrary(feasts)       # Feature extraction & decomposition\nlibrary(fable)        # Forecasting models (ARIMA, ETS, etc.)\nlibrary(fpp3)         # Tidy time series dataseta\nlibrary(astsa)        # Applied statistical TS methods from textbook\nlibrary(tseries)      # Unit root tests & TS diagnostics\nlibrary(tsibbledata)  # Curated TS datasets\nlibrary(quantmod)     # Financial data retrieval\nlibrary(tidyquant)    # Financial analysis in tidyverse\nlibrary(purrr)        # Functional programming for TS pipelines\nlibrary(readr)        # Efficient data import\n```\n:::\n\n\n\n## Model Selection & Diagnostic Criteria\n\nToday, we will walk through a complete model selection exercise using VIX data. Our goals are to:\n\n- Perform Exploratory Data Analysis (EDA) with visual diagnostics.\n- Fit built-in models (ARIMA and ETS) using the `Tidyverts` framework.\n- Evaluate models based on five metrics: AIC, AICc, BIC, Mean Squared Error (MSE), and Root Mean Squared Error (RMSE).\n- Conclude on the optimal model by comparing these metrics along with residual diagnostics and forecast performance.\n\nFor a model with $n$ observations and $k$ parameters (including the intercept), the evaluation criteria are defined as:\n\n$$\n\\begin{align}\n\\text{AIC} &= n\\ln\\left(\\frac{\\text{RSS}}{n}\\right) + 2k,\\\\[1mm]\n\\text{BIC} &= n\\ln\\left(\\frac{\\text{RSS}}{n}\\right) + k\\ln(n),\\\\[1mm]\n\\text{AICc} &= \\text{AIC} + \\frac{2k(k+1)}{n-k-1},\n\\end{align}\n$$\n\nand the error metrics:\n\n$$\n\\begin{align}\n\\text{MSE} &= \\frac{\\text{RSS}}{n},\\\\[1mm]\n\\text{RMSE} &= \\sqrt{\\text{MSE}}.\n\\end{align}\n$$\n\n\n# Data Preparation\n\nWe retrieve the VIX data and format as a `tsibble`, handling missing values while preserving the original adjusted price series.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Retrieve VIX data from 2000-01-01 to current date and convert to a tsibble\nvix_data <- tq_get(\"^VIX\", from = \"2000-01-01\", \n                   to = \"2025-01-01\", \n                   get = \"stock.prices\") %>% \n  as_tsibble(index = date)\n\n# Clean and interpolate missing values\nvix_data <- vix_data %>% \n  tsibble::fill_gaps() %>% \n  mutate(adjusted = zoo::na.approx(adjusted)) %>% \n  select(date, adjusted) %>% \n  tidyr::drop_na()\n```\n:::\n\n# Exploratory Data Analysis (EDA)\n\n## Time Series Plot\n\n::: {.cell}\n\n```{.r .cell-code}\nvix_data %>% \n  autoplot(adjusted) +\n  labs(title = \"VIX Adjusted Prices\", y = \"Adjusted\", x = \"Date\")\n```\n\n::: {.cell-output-display}\n![](activity12_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n## ACF and PACF Analysis\n\n::: {.cell}\n\n```{.r .cell-code}\nvix_data %>% \n  ACF(adjusted) %>% \n  autoplot() +\n  labs(title = \"ACF of VIX Data\")\n```\n\n::: {.cell-output-display}\n![](activity12_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nvix_data %>% \n  PACF(adjusted) %>% \n  autoplot() +\n  labs(title = \"PACF of VIX Data\")\n```\n\n::: {.cell-output-display}\n![](activity12_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n> **Observation:**  \n> The persistence in ACF suggests potential need for differencing, but we'll let ARIMA automatically handle any required transformations through its $d$ parameter.\n\n# Model Fitting Using Tidyverts\n\n## 1. ARIMA Model (Original Series)\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit an ARIMA model on original series\nmodel_arima <- vix_data %>% \n  model(ARIMA(adjusted))\n\n# Display summary report\nreport(model_arima)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: adjusted \nModel: ARIMA(3,1,1)(0,0,2)[7] \n\nCoefficients:\n         ar1     ar2      ar3      ma1    sma1    sma2\n      0.9615  0.0082  -0.0179  -0.9811  0.0286  0.0553\ns.e.  0.0168  0.0145   0.0122   0.0133  0.0115  0.0107\n\nsigma^2 estimated as 1.728:  log likelihood=-15446.52\nAIC=30907.05   AICc=30907.06   BIC=30956.88\n```\n\n\n:::\n\n```{.r .cell-code}\n# Display accuracy metrics\nmodel_arima %>% accuracy()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 10\n  .model          .type         ME  RMSE   MAE    MPE  MAPE  MASE RMSSE     ACF1\n  <chr>           <chr>      <dbl> <dbl> <dbl>  <dbl> <dbl> <dbl> <dbl>    <dbl>\n1 ARIMA(adjusted) Traini… -0.00181  1.31 0.731 -0.220  3.42 0.356 0.403 -2.97e-4\n```\n\n\n:::\n:::\n\n## 2. ETS Model\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit ETS model on original series\nmodel_ets <- vix_data %>% \n  model(ETS(adjusted))\n\n# Display summary report\nreport(model_ets)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: adjusted \nModel: ETS(M,Ad,M) \n  Smoothing parameters:\n    alpha = 0.9998863 \n    beta  = 0.0449181 \n    gamma = 0.0001019892 \n    phi   = 0.8178318 \n\n  Initial states:\n     l[0]       b[0]    s[0]     s[-1]     s[-2]    s[-3]     s[-4]     s[-5]\n 25.49738 -0.7829361 1.00114 0.9990668 0.9956332 1.002539 0.9994978 0.9996608\n    s[-6]\n 1.002462\n\n  sigma^2:  0.003\n\n     AIC     AICc      BIC \n83569.41 83569.45 83661.96 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Display accuracy metrics\nmodel_ets %>% accuracy()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 10\n  .model        .type           ME  RMSE   MAE    MPE  MAPE  MASE RMSSE    ACF1\n  <chr>         <chr>        <dbl> <dbl> <dbl>  <dbl> <dbl> <dbl> <dbl>   <dbl>\n1 ETS(adjusted) Training -0.000342  1.32 0.732 -0.120  3.43 0.356 0.405 -0.0392\n```\n\n\n:::\n:::\n\n# Forecasting with the Optimal Model\n\n::: {.cell}\n\n```{.r .cell-code}\n# Forecast 12 months ahead using ARIMA\nforecast_arima <- model_arima %>% \n  forecast(h = \"12 months\")\n\n# Plot forecast in original units\nforecast_arima %>% \n  autoplot(vix_data) +\n  labs(title = \"12-Month VIX Forecast\", y = \"Adjusted VIX\", x = \"Date\")\n```\n\n::: {.cell-output-display}\n![](activity12_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## **Lab Activity: Modeling Stock Returns with ARIMA**\n\nModel daily SPY returns using ARIMA, analyze residuals, and compare with ETS. \n\n**Tasks**  \n\n1. Retrieve SPY data (2015-01-01 to present) and compute **daily log returns**  \n2. Perform EDA (time series plot, ACF/PACF)  \n3. Fit ARIMA(2,0,1) and ETS models to returns  \n4. Compare models using AIC and RMSE  \n5. Forecast 1-month ahead returns\n\n\n\n**Solution**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Task 1: Data Preparation\nspy_data <- tq_get(\"SPY\", from = \"2015-01-01\") %>% \n  as_tsibble(index = date) %>% \n  tsibble::fill_gaps() %>% \n  mutate(adjusted = na.approx(adjusted),\n         log_return = difference(log(adjusted))) %>% \n  select(date, adjusted, log_return) %>% \n  tidyr::drop_na()\n\n\n# Task 2: EDA\nspy_data %>% autoplot(log_return) +\n  labs(title = \"SPY Daily Log Returns\", y = \"Return\")\n```\n\n::: {.cell-output-display}\n![](activity12_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\nspy_data %>% ACF(log_return) %>% autoplot()\n```\n\n::: {.cell-output-display}\n![](activity12_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n\n```{.r .cell-code}\nspy_data %>% PACF(log_return) %>% autoplot()\n```\n\n::: {.cell-output-display}\n![](activity12_files/figure-html/unnamed-chunk-8-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# Task 3: Model Fitting\nfit_arima <- spy_data %>% \n  model(ARIMA(log_return ~ pdq(2,0,1)))\n\nfit_ets <- spy_data %>% \n  model(ETS(log_return))\n\n# Task 4: Model Comparison\nglance(fit_arima) %>% select(AIC, AICc, BIC)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n      AIC    AICc     BIC\n    <dbl>   <dbl>   <dbl>\n1 -24852. -24852. -24802.\n```\n\n\n:::\n\n```{.r .cell-code}\nglance(fit_ets) %>% select(AIC, AICc, BIC)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n     AIC   AICc    BIC\n   <dbl>  <dbl>  <dbl>\n1 -4946. -4946. -4927.\n```\n\n\n:::\n\n```{.r .cell-code}\naccuracy(fit_arima)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 10\n  .model         .type       ME    RMSE     MAE   MPE  MAPE  MASE RMSSE     ACF1\n  <chr>          <chr>    <dbl>   <dbl>   <dbl> <dbl> <dbl> <dbl> <dbl>    <dbl>\n1 ARIMA(log_ret… Trai… -3.84e-6 0.00837 0.00502   NaN   Inf 0.691 0.709 -4.20e-4\n```\n\n\n:::\n\n```{.r .cell-code}\naccuracy(fit_ets)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 10\n  .model          .type       ME    RMSE     MAE   MPE  MAPE  MASE RMSSE    ACF1\n  <chr>           <chr>    <dbl>   <dbl>   <dbl> <dbl> <dbl> <dbl> <dbl>   <dbl>\n1 ETS(log_return) Train… 8.24e-6 0.00842 0.00501  -Inf   Inf 0.689 0.713 -0.0153\n```\n\n\n:::\n\n```{.r .cell-code}\n# Task 5: Forecasting\nfit_arima %>% \n  forecast(h = 30) %>% \n  autoplot(spy_data) +\n  labs(title = \"30-Day SPY Return Forecast\", y = \"Log Return\")\n```\n\n::: {.cell-output-display}\n![](activity12_files/figure-html/unnamed-chunk-8-4.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "activity12_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}