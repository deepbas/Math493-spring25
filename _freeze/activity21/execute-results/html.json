{
  "hash": "bf4dd2a837e30fe87a64afb9e7ab5d0a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Activity21\"\nformat: html\nwarning: false\nmessage: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# Time Series Essentials, install if needed!\nlibrary(feasts)       # Feature extraction & decomposition\nlibrary(fable)        # Forecasting models (ARIMA, ETS, etc.)\nlibrary(fpp3)         # Tidy time series dataseta\nlibrary(astsa)        # Applied statistical TS methods from textbook\nlibrary(tseries)      # Unit root tests & TS diagnostics\nlibrary(tsibbledata)  # Curated TS datasets\nlibrary(quantmod)     # Financial data retrieval\nlibrary(tidyquant)    # Financial analysis in tidyverse\nlibrary(purrr)        # Functional programming for TS pipelines\nlibrary(readr)        # Efficient data import\n```\n:::\n\n\n\n\n# Theoretical Foundations of AR Models\n\n## **Time Series Nature & Stationarity**\n\nDefine AR($p$): $Y_t = \\phi_1 Y_{t-1} + \\dots + \\phi_p Y_{t-p} + \\epsilon_t$, $\\epsilon_t \\sim WN(0,\\sigma^2)$  \n\n\n**AR(p) Properties**:\n\n- Captures *temporal dependence* through lagged terms\n- PACF cuts off after lag $p$\n- Requires stationarity for reliable inference\n- Unit root non-stationarity occurs when characteristic equation $1 - \\phi_1 z - \\cdots - \\phi_p z^p = 0$ has roots *on* unit circle\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fable)\nset.seed(123)\nar_data <- tibble(time = 1:100, y = arima.sim(model = list(ar = c(0.7, -0.2)), n = 100)) %>% \n  as_tsibble(index = time)\n\nar_data %>% \n  gg_tsdisplay(y, plot_type = c(\"scatter\")) + # ACF/PACF\n  labs(title = \"AR(2) Process: φ₁=0.7, φ₂=-0.2\")\n```\n\n::: {.cell-output-display}\n![](activity21_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n**Model Fitting & Diagnostics**  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_ar <- ar_data %>% \n  model(ARIMA(y ~ pdq(2,0,0))) # Explicit AR specification\n\nreport(fit_ar) # Check coefficients & σ²\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: y \nModel: ARIMA(2,0,0) \n\nCoefficients:\n         ar1      ar2\n      0.6757  -0.1576\ns.e.  0.0990   0.1002\n\nsigma^2 estimated as 0.8167:  log likelihood=-130.99\nAIC=267.99   AICc=268.24   BIC=275.8\n```\n\n\n:::\n\n```{.r .cell-code}\nfit_ar %>% residuals() %>% gg_tsdisplay(plot_type = c(\"scatter\")) # Residual diagnostics\n```\n\n::: {.cell-output-display}\n![](activity21_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## **Real-World Process: US Consumption**\n\nFrom the *global_economy* dataset (Ch. 5 of text), we'll analyze quarterly percentage changes in personal consumption expenditures (stationary series):\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fpp3)\ndata(us_change)\nconsumption_ts <- us_change %>%\n  select(Quarter, Consumption) %>%\n  as_tsibble(index = Quarter)\n```\n:::\n\n\n### **Lab Activity A: AR Modeling with Real Data**\n\n**Exploratory Analysis & Stationarity**\n\n1. **Visualize Series**:\n\n::: {.cell}\n\n```{.r .cell-code}\nconsumption_ts %>%\n  autoplot(Consumption) +\n  labs(title = \"US Consumption Changes\", y = \"% Change\")\n```\n\n::: {.cell-output-display}\n![](activity21_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n2. **Stationarity Assessment**:\n\n::: {.cell}\n\n```{.r .cell-code}\nconsumption_ts %>%\n  features(Consumption, unitroot_kpss) # H0: Stationary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  kpss_stat kpss_pvalue\n      <dbl>       <dbl>\n1     0.275         0.1\n```\n\n\n:::\n\n```{.r .cell-code}\nconsumption_ts %>%\n  gg_tsdisplay(Consumption, plot_type = \"partial\")\n```\n\n::: {.cell-output-display}\n![](activity21_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n**Model Fitting & Forecasting**\n\n1. **Fit AR Model**:\n\n::: {.cell}\n\n```{.r .cell-code}\nar_fit <- consumption_ts %>%\n  model(ARIMA(Consumption ~ pdq(2,0,0)))\n\nreport(ar_fit) # Compare φ coefficients to simulation\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSeries: Consumption \nModel: ARIMA(2,0,0)(2,0,0)[4] w/ mean \n\nCoefficients:\n        ar1     ar2     sar1     sar2  constant\n      0.256  0.2350  -0.0172  -0.1488    0.4406\ns.e.  0.071  0.0704   0.0760   0.0716    0.0412\n\nsigma^2 estimated as 0.3453:  log likelihood=-173.33\nAIC=358.67   AICc=359.11   BIC=378.4\n```\n\n\n:::\n:::\n\n2. **Residual Diagnostics**:\n\n::: {.cell}\n\n```{.r .cell-code}\nar_fit %>%\n  residuals() %>%\n  gg_tsdisplay(.resid, plot_type = \"partial\") +\n  labs(title = \"Residual Diagnostics\")\n```\n\n::: {.cell-output-display}\n![](activity21_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n3. **Forecasting**:\n\n::: {.cell}\n\n```{.r .cell-code}\nar_fit %>%\n  forecast(h = 8) %>%\n  autoplot(consumption_ts) +\n  labs(title = \"2-Year Consumption Forecast\")\n```\n\n::: {.cell-output-display}\n![](activity21_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n### **Lab Activity B: Real-World Application - US Income Changes**\n\n**1. Data Preparation & Visualization**\n\n::: {.cell}\n\n```{.r .cell-code}\nincome_ts <- us_change %>%\n  select(Quarter, Income) %>%\n  as_tsibble(index = Quarter)\n\nincome_ts %>%\n  autoplot(Income) +\n  labs(title = \"US Personal Income Growth Rate\", y = \"% Change\")\n```\n\n::: {.cell-output-display}\n![](activity21_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n**2. Order Identification**  \n\nDetermine appropriate AR order through PACF:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincome_ts %>%\n  gg_tsdisplay(Income, plot_type = \"partial\", lag_max = 8) +\n  labs(title = \"Income Series Diagnostics\")\n```\n\n::: {.cell-output-display}\n![](activity21_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\n**3. Model Comparison**  \n\nFit competing specifications and evaluate:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincome_models <- income_ts %>%\n  model(\n    AR1 = ARIMA(Income ~ pdq(1,0,0)),\n    AR2 = ARIMA(Income ~ pdq(2,0,0)),\n    Auto = ARIMA(Income)\n  )\n\nglance(income_models) %>% arrange(AICc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 8\n  .model sigma2 log_lik   AIC  AICc   BIC ar_roots  ma_roots \n  <chr>   <dbl>   <dbl> <dbl> <dbl> <dbl> <list>    <list>   \n1 Auto    0.784   -255.  519.  519.  532. <cpl [0]> <cpl [2]>\n2 AR2     0.790   -256.  520.  521.  534. <cpl [2]> <cpl [0]>\n3 AR1     0.802   -258.  522.  522.  532. <cpl [1]> <cpl [0]>\n```\n\n\n:::\n:::\n\n\n\n**4. Forecasting & Policy Implications**  \n\nUsing the best model, generate forecasts up-to 10 time points into the future and interpret economic meaning:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincome_models %>%\n  select(AR2) %>%\n  forecast(h = 8) %>%\n  autoplot(income_ts) +\n  labs(title = \"2-Year Income Growth Forecast\",\n       subtitle = \"AR(2) Model Projection\")\n```\n\n::: {.cell-output-display}\n![](activity21_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n",
    "supporting": [
      "activity21_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}