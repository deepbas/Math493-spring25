{
  "hash": "9af1ffed8e6d1d1defd398132cea6ce4",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Activity2\"\nformat: html\nwarning: false\nmessage: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# Time Series Essentials, install if needed!\nlibrary(feasts)       # Feature extraction & decomposition\nlibrary(fable)        # Forecasting models (ARIMA, ETS, etc.)\nlibrary(fpp3)         # Tidy time series dataseta\nlibrary(astsa)        # Applied statistical TS methods from textbook\nlibrary(tseries)      # Unit root tests & TS diagnostics\nlibrary(tsibbledata)  # Curated TS datasets\nlibrary(quantmod)     # Financial data retrieval\nlibrary(tidyquant)    # Financial analysis in tidyverse\nlibrary(purrr)        # Functional programming for TS pipelines\nlibrary(readr)        # Efficient data import\n```\n:::\n\n\n\n\n## Correlation, Covariance, and Partial Correlation in Time Series\n\nIn time series analysis, understanding relationships between different variables is crucial. Three fundamental statistical concepts that help capture these relationships are **covariance**, **correlation**, and **partial correlation**.\n\n### Covariance\n\nCovariance measures how two variables move together. For two time series $X_t$ and $Y_t$, the sample covariance over $n$ periods is given by:\n\n$$\n\\text{Cov}(X, Y) = \\frac{1}{n-1} \\sum_{t=1}^{n} (X_t - \\bar{X})(Y_t - \\bar{Y})\n$$\n\nwhere $\\bar{X}$ and $\\bar{Y}$ are the sample means. A positive covariance indicates that when $X_t$ is above its mean, $Y_t$ tends to be above its mean as well, and vice versa.\n\n### Correlation\n\nCorrelation standardizes covariance, providing a dimensionless measure between -1 and 1:\n\n$$\n\\rho_{XY} = \\frac{\\text{Cov}(X, Y)}{\\sigma_X \\sigma_Y}\n$$\n\nwhere $\\sigma_X$ and $\\sigma_Y$ are the standard deviations of $X_t$ and $Y_t$. A correlation of 1 means perfect positive linear relationship, -1 means perfect negative linear relationship, and 0 suggests no linear relationship.\n\n### Partial Correlation\n\nPartial correlation measures the relationship between two variables while controlling for the effect of one or more additional variables. For three variables $X$, $Y$, and $Z$, the partial correlation between $X$ and $Y$ controlling for $Z$ is defined as:\n\n$$\n\\rho_{XY \\cdot Z} = \\frac{\\rho_{XY} - \\rho_{XZ}\\rho_{YZ}}{\\sqrt{(1-\\rho_{XZ}^2)(1-\\rho_{YZ}^2)}}\n$$\n\nThis formula removes the influence of $Z$ on both $X$ and $Y$, providing a clearer picture of their direct relationship.\n\n\n\n## Applied Example Using `fpp3` Data\n\nConsider the `global_economy` dataset from the `fpp3` package, which contains economic indicators for various countries over time. We can explore relationships such as:\n\n- Covariance and correlation between Growth and CPI for different countries.\n- Partial correlation to understand the relationship between Imports and Exports while controlling for GDP.\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|Country             |Code | Year|          GDP|     Growth|       CPI|  Imports|   Exports| Population|\n|:-------------------|:----|----:|------------:|----------:|---------:|--------:|---------:|----------:|\n|Low income          |LIC  | 1961|           NA|         NA|        NA|       NA|        NA|  170210778|\n|Malawi              |MWI  | 1968| 2.451698e+08| -1.9230792|        NA| 39.15810| 23.837494|    4370650|\n|St. Kitts and Nevis |KNA  | 2009| 7.670664e+08| -3.3684794|  99.15630| 47.89495| 23.019602|      50886|\n|Guam                |GUM  | 2003| 3.560000e+09|  0.9205984|        NA| 46.46067| 17.724719|     157714|\n|North America       |NAC  | 2000| 1.103055e+13|  4.1970916|        NA| 16.52401| 13.711497|  312993944|\n|Latvia              |LVA  | 2013| 3.025468e+10|  2.4298512| 106.69577| 63.85393| 60.304180|    2012647|\n|Spain               |ESP  | 1977| 1.320895e+11|  2.8385743|  13.30427| 15.87719| 13.315424|   36511638|\n|Rwanda              |RWA  | 1989| 2.405022e+09| -0.0365343|  11.81598| 17.28848|  6.139289|    7216028|\n|Chad                |TCD  | 1982| 8.343699e+08|  5.3466090|        NA| 13.49483|  6.561972|    4715197|\n|Belarus             |BLR  | 1987|           NA|         NA|        NA|       NA|        NA|   10111000|\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter data for Australia and select relevant variables\naus_data <- global_economy %>%\n  filter(Country == \"Australia\") %>%    # <1>\n  select(Year, GDP, Growth, Population, CPI, Imports, Exports) # <2>\n```\n:::\n\n\n\n1. Filter the `global_economy` dataset to include only rows where the country is Australia.\n2. Select the variables of interest: Year, Growth, Population, and CPI\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate covariance between GDP and Population for Australia\ncov_gdp_pop <- cov(aus_data$Growth, aus_data$CPI, use = \"complete.obs\")  # <1>\ncov_gdp_pop  \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -17.36472\n```\n\n\n:::\n:::\n\n\n\n1. Compute the covariance between Growth and CPI for the Australian subset, using complete observations.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate correlation between GDP and Population for Australia\ncor_gdp_pop <- cor(aus_data$Growth, aus_data$CPI, use = \"complete.obs\")  # <1>\ncor_gdp_pop  \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -0.2779003\n```\n\n\n:::\n:::\n\n\n\n1. Compute the Pearson correlation coefficient between GDP and Population.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute correlation matrix for GDP, Population, and Life Expectancy\ncor_matrix <- aus_data %>%\n  select(GDP, Growth, Population, CPI, Imports, Exports) %>%  # <1>\n  cor(use = \"complete.obs\")             # <2>\ncor_matrix  # <11>\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  GDP     Growth Population        CPI    Imports    Exports\nGDP         1.0000000 -0.2494090  0.9073355  0.9003771  0.7831384  0.8128970\nGrowth     -0.2494090  1.0000000 -0.2950084 -0.2779003 -0.1753012 -0.2251961\nPopulation  0.9073355 -0.2950084  1.0000000  0.9899235  0.9054921  0.9114850\nCPI         0.9003771 -0.2779003  0.9899235  1.0000000  0.9313180  0.9275880\nImports     0.7831384 -0.1753012  0.9054921  0.9313180  1.0000000  0.9238266\nExports     0.8128970 -0.2251961  0.9114850  0.9275880  0.9238266  1.0000000\nYear        0.8801466 -0.2863494  0.9966214  0.9906993  0.9224200  0.9195759\n                 Year\nGDP         0.8801466\nGrowth     -0.2863494\nPopulation  0.9966214\nCPI         0.9906993\nImports     0.9224200\nExports     0.9195759\nYear        1.0000000\n```\n\n\n:::\n:::\n\n\n\n1. Select columns for GDP, Growth, Population, CPI, Imports, and Exports from the Australian data.\n2. Calculate the correlation matrix for these variables using complete observations.\n\n- Partial correlation to understand the relationship between Imports and Exports while controlling for GDP.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Partial correlation between Imports and Exports controlling for GDP manually\n# Extract relevant correlation coefficients from the matrix\nrho_Imports_Exports <- cor_matrix[\"Imports\", \"Exports\"]         # <1>\nrho_Imports_GDP <- cor_matrix[\"Imports\", \"GDP\"]          # <2>\nrho_Exports_GDP <- cor_matrix[\"Exports\", \"GDP\"]  # <3>\n```\n:::\n\n\n\n1. Extracts the direct correlation between Imports and Exports.\n2. Extracts the correlation between Imports and GDP.\n3. Extracts the correlation between Exports and GDP.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute partial correlation between Imports and Exports controlling for GDP\npcorr_Imp_Exp_GDP <- (rho_Imports_Exports - rho_Imports_GDP * rho_Exports_GDP) /\n  sqrt((1 - rho_Imports_GDP^2) * (1 - rho_Exports_GDP^2))   # <1> \npcorr_Imp_Exp_GDP  # Display partial correlation result\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.7930442\n```\n\n\n:::\n:::\n\n\n\n1. Apply the partial correlation formula to compute the relationship between GDP and Life Expectancy, controlling for Population.\n\n## Lab Activity: Recreate the above analysis using the class activity template.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}